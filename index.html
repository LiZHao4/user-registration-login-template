<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>主页</title>
		<link rel="stylesheet" href="style.css" />
	</head>
	<body>
		<div id="top" class="top">
			<div class="right">
				<a class="link1" href="javascript:logoutAccount();">退出登录</a>
			</div>
		</div>
		<div class="card" id="card">
			<table>
				<tr>
					<td class="table"><img class="avatar" id="avatar"></td>
					<td class="table">
						<div class="big" id="nickname"></div>
						<div class="small">用户名：<span id="user"></span></div>
						<div class="small">ID：<span id="id"></span></div>
						<div class="small">用户创建时间：<span id="time"></span></div>
					</td>
				</tr>
			</table>
			<div class="link1" style="text-align:right;"><span class="pointer" id="config">修改</span></div>
		</div>
		<div class="card" id="subcard" style="text-align:center"><div class="link"><a class="link1" href="login.html">您还未登录，点击此处登录</a></div></div>
		<script src="js/lib.js"></script>
		<script>
			window.onload = function() {
				var storedToken = getCookie('_');
				if (!storedToken) {
					document.getElementById('card').style.display = 'none';
					document.getElementById('top').style.display = 'none';
					document.getElementById('subcard').style.display = 'block';
					return;
				}
				document.getElementById('subcard').style.display = 'none';
				var queryParams = new URLSearchParams({
					token: storedToken,
					v: 2
				});
				var xhrRequest = new XMLHttpRequest();
				xhrRequest.open('POST', 'user_data.php', true);
				xhrRequest.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
				xhrRequest.onreadystatechange = function() {
					if (xhrRequest.readyState === 4 && xhrRequest.status === 200) {
						var serverResponse = JSON.parse(xhrRequest.responseText);
						if (serverResponse.code === 1) {
							var data = serverResponse.data;
							document.getElementById('nickname').innerText = data.nick;
							document.getElementById('user').innerText = data.user;
							document.getElementById('id').innerText = data.id;
							document.getElementById('time').innerText = data.time;
							if (data.avatar) {
								document.getElementById('avatar').setAttribute('src', 'avatar/' + data.token + '.jpg');
							} else {
								document.getElementById('avatar').setAttribute('src', 'default.jpg');
							}
						}
					}
				};
				xhrRequest.send(queryParams.toString());
			};
			document.getElementById('config').addEventListener('click', function() {
				location.href = "change.html";
			});
		</script>
	</body>
</html>