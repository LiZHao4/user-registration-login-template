<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>注册</title>
		<link rel="stylesheet" href="style.css" />
	</head>
	<body class="flex">
		<div class="form">
			<table class="table0">
				<tr>
					<td class="col1"></td>
					<td><h2>注册</h2></td>
					<td class="col1 col2"><img id="icon" src="icon.jpg" alt="图标" /></td>
				</tr>
			</table>
			<div class="popup" id="popup">用户名必须以字母、下划线_或美元符号$开头，可包含字母（大小写）、数字、下划线_或美元符号$，总长度1到32位。密码长度8到32位，必须包含至少1个小写字母、1个大写字母和1个数字。</div>
			<label for="user">　用户名：</label><input type="text" id="user" placeholder="请输入用户名" class="text1" /><br />
			<label for="pass">　　密码：</label><input type="password" id="pass" placeholder="请输入密码" class="text1" /><br />
			<label for="repass">确认密码：</label><input type="password" id="repass" placeholder="请确认密码" class="text1" /><br />
			<button class="submit" id="submit">注册</button>
		</div>
		<script src="js/lib.js"></script>
		<script>
			document.getElementById('submit').addEventListener('click', function() {
				var username = document.getElementById('user').value;
				var password = document.getElementById('pass').value;
				var confirmPassword = document.getElementById('repass').value;
				if (!/^[a-zA-Z_$][a-zA-Z0-9_$]{0,31}$/.test(username) || password.length < 8 || password.length > 32 || !/[a-z]/.test(password) || !/[A-Z]/.test(password) || !/\d/.test(password)) {
					showPop('账户名或密码不合规！\n规则：用户名必须以字母、下划线_或美元符号$开头，可包含字母（大小写）、数字、下划线_或美元符号$，总长度1到32位。密码长度8到32位，必须包含至少1个小写字母、1个大写字母和1个数字。');
					return;
				} else if (password !== confirmPassword) {
					showPop('密码与确认密码不一致！');
					return;
				} else {
					var authParams = new URLSearchParams({
						user: username,
						pass: password,
						from: 'regist',
						v: '2'
					});
					var xhr = new XMLHttpRequest();
					xhr.open('POST', 'user_auth.php', true);
					xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
					xhr.onreadystatechange = function() {
						if (xhr.readyState === 4 && xhr.status === 200) {
							var response = JSON.parse(xhr.responseText);
							if (response.code === 1) {
								location.href = 'login.html';
							} else {
								showPop(response.msg);
							}
						}
					};
					xhr.send(authParams.toString());
				}
			});
			document.getElementById('icon').addEventListener('mouseenter', function() {
				document.getElementById('popup').style.visibility = 'visible';
			});
			document.getElementById('icon').addEventListener('mouseleave', function() {
				document.getElementById('popup').style.visibility = 'hidden';
			});
		</script>
	</body>
</html>