<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>登录</title>
		<link rel="stylesheet" href="style.css" />
	</head>
	<body class="flex">
		<div id="form">
			<h2 id="sp">登录</h2>
			<div id="pop"></div>
			<label for="user">用户名：</label><input type="text" id="user" placeholder="请输入用户名" class="text" /><br />
			<label for="pass">　密码：</label><input type="password" id="pass" placeholder="请输入密码" class="text" /><br />
			<button id="submit">登录</button><a href="regist.html"><button id="regist">注册</button></a>
		</div>
		<script>
			document.getElementById('submit').addEventListener('click', function() {
			var username = document.getElementById('user').value;
			var password = document.getElementById('pass').value;
			if (!/^[a-zA-Z_$][a-zA-Z0-9_$]{0,31}$/.test(username) || password.length < 8 || password.length > 32 || !/[a-z]/.test(password) || !/[A-Z]/.test(password) || !/\d/.test(password)) {
				document.getElementById('pop').innerText = '账户名或密码不合规！\n规则：用户名必须以字母、下划线_或美元符号$开头，可包含字母（大小写）、数字、下划线_或美元符号$，总长度1到32位。密码长度8到32位，必须包含至少1个小写字母、1个大写字母和1个数字。';
				document.getElementById('pop').style.visibility = 'visible';
				return;
			} else {
				var authParams = new URLSearchParams({
					user: username,
					pass: password,
					from: 'login'
				});
				var xhr = new XMLHttpRequest();
				xhr.open('POST', 'user_auth.php', true);
				xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
				xhr.onreadystatechange = function () {
					if (xhr.readyState === 4 && xhr.status === 200) {
						var responseText = xhr.responseText;
						if (responseText === "fail") {
							document.getElementById('pop').innerText = '登录失败，请稍后再试！';
							document.getElementById('pop').style.visibility = 'visible';
						} else if (responseText === "wrong") {
							document.getElementById('pop').innerText = '密码错误！';
							document.getElementById('pop').style.visibility = 'visible';
						} else if (responseText === "not_exist") {
							document.getElementById('pop').innerText = '用户不存在！';
							document.getElementById('pop').style.visibility = 'visible';
						} else {
							localStorage.setItem('_', responseText);
							location.href = 'index.html';
						}
					}
				};
				xhr.send(authParams.toString());
			}
		});
		</script>
	</body>
</html>